# YOLOv8 模型配置文档

**版本：P0-20251129**
**状态：使用默认配置（P0阶段）**
**维护者：开发者B（AI模型工程师）**

---

## 📋 概述

本文档描述了智能高铁巡检系统中使用的YOLOv8模型配置参数。在P0阶段，我们使用ultralytics库的默认参数，确保系统稳定性和可预测性。

## 🎯 检测目标类别

系统检测以下3类电杆：

| 类别索引 | 类别名称 (英文) | 类别名称 (中文) | 描述 |
|---------|----------------|----------------|------|
| 0 | `iron_pole` | 钢制电杆 | 电力传输使用的钢制杆塔 |
| 1 | `concrete_pole` | 混凝土电杆 | 水泥混凝土材质的电杆 |
| 2 | `iron_gantry_pole` | 钢制门型电杆 | 大型门型钢结构电杆 |

## ⚙️ 当前配置 (P0阶段)

### 1. 推理参数

```python
# 当前使用的推理配置（ultralytics默认值）
model = YOLO("models/best.onnx")
results = model(frame)  # 不显式设置任何参数
```

**实际使用的默认参数：**
- **置信度阈值 (conf)**: 0.25 (ultralytics默认)
- **NMS IoU阈值 (iou)**: 0.7 (ultralytics默认)
- **最大检测数量 (max_det)**: 300 (ultralytics默认)

### 2. 模型信息

- **模型文件**: `models/best.onnx`
- **输入尺寸**: 640x640 (自动调整)
- **推理后端**: ONNX Runtime
- **支持设备**: CPU / GPU (自动检测)

## 📊 性能基准

### 推理速度（基于测试环境）
- **CPU推理**: ~15-25 FPS (Intel i7, 1080p视频)
- **GPU推理**: ~60-120 FPS (NVIDIA RTX 3060, 1080p视频)
- **内存占用**: ~2GB (包含模型和缓存)

### 检测精度（基于验证数据集）
- **mAP@0.5**: 待测试
- **精确率**: 待测试
- **召回率**: 待测试

*注：P0阶段暂未进行详细的精度评估，P1阶段将补充完整测试*

## 🔧 P1阶段可调参数

### 1. 置信度阈值调优

```python
# P1阶段可调整的置信度阈值
model = YOLO("models/best.onnx")
results = model(frame, conf=0.30)  # 提高置信度阈值，减少误检
```

**建议范围：**
- **高精度模式**: `conf=0.40` (减少误检，可能漏检)
- **平衡模式**: `conf=0.25` (默认，平衡精度和召回率)
- **高召回模式**: `conf=0.15` (减少漏检，可能误检)

### 2. NMS IoU阈值调优

```python
# P1阶段可调整的NMS阈值
results = model(frame, iou=0.6)  # 更严格的NMS，减少重叠框
```

**建议范围：**
- **严格模式**: `iou=0.5` (更少的重叠框)
- **标准模式**: `iou=0.7` (默认，平衡效果)
- **宽松模式**: `iou=0.8` (保留更多重叠框)

## 🎨 检测框颜色配置

前端显示时使用的颜色映射：

| 类别 | 颜色 | Hex值 | 用途 |
|------|------|-------|------|
| `iron_pole` | 红色 | `#EF4444` | 钢制电杆 |
| `concrete_pole` | 蓝色 | `#3B82F6` | 混凝土电杆 |
| `iron_gantry_pole` | 绿色 | `#10B981` | 门型电杆 |

## 📝 配置变更日志

### P0阶段 (2025-11-29)
- ✅ 初始配置确定
- ✅ 使用ultralytics默认参数
- ✅ 3类电杆检测验证通过
- ✅ ONNX模型集成完成

### 计划中的P1改进
- 🔄 基于实际数据调优conf/iou参数
- 🔄 性能基准测试
- 🔄 多分辨率支持优化
- 🔄 模型量化实验

## 🚀 性能优化建议

### 1. 大视频处理优化
```python
# 对于长视频，建议分段处理
SEGMENT_DURATION = 300  # 5分钟一段
```

### 2. 内存使用优化
```python
# 及时释放不需要的结果
del results
import gc
gc.collect()
```

### 3. 批处理优化
```python
# 如果支持，可以进行批量推理
batch_frames = [frame1, frame2, frame3]
results = model(batch_frames)
```

## ⚠️ 注意事项

### 1. P0阶段限制
- ❌ 不进行模型参数调优
- ❌ 不修改默认阈值
- ❌ 不进行模型量化
- ❌ 不使用TensorRT等加速库

### 2. 依赖环境
- Python >= 3.8
- ultralytics == 8.3.0
- onnxruntime == 1.19.2
- OpenCV >= 4.5.0

### 3. 硬件要求
- **最小内存**: 4GB RAM
- **推荐内存**: 8GB+ RAM
- **存储空间**: 至少1GB可用空间（模型文件+缓存）

## 🔗 相关文档

- [API接口文档](./api.md) - 接口规范和调用方式
- [坐标转换文档](./coordinate-utils.md) - 视频坐标到Canvas坐标转换
- [性能优化指南](./performance-tips.md) - 系统性能优化建议

---

**文档维护说明：**
- P0阶段只记录当前配置，不进行调优
- P1阶段将根据实际测试结果更新参数建议
- 任何配置变更需要经过团队评审和测试验证